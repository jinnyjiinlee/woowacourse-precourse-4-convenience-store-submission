# 🏪 우아한테크코스 프리코스 4주차 - 편의점 (javascript-convenience-store-precourse)

> **프로젝트명:** `javascript-convenience-store-precourse`  
> **기간:** 2024.11.01 ~ 2024.11.07 (예시)

**W 편의점 결제 시스템**  
사용자의 할인 혜택(프로모션, 멤버십)과 재고 상황을 고려하여 최종 결제 금액을 안내하는 편의점 시스템입니다.

---

###  💸 W 편의점 결제 시스템

<br/>

## 🎯 프로젝트 소개

이 프로젝트는 우아한테크코스 프리코스 4주차 미션으로, 사용자가 입력한 **상품명과 수량**을 기반으로  
**프로모션 재고**, **멤버십 할인**, **재고 소진** 등을 종합적으로 처리하여 **최종 결제 금액**과  
**영수증**을 산출하는 기능을 구현합니다.

- **핵심 목표**  
  1. **클래스**와 **함수** 분리를 통해 단일 책임 원칙(SRP) 준수  
  2. **Jest 테스트**(4개 이상) 통과로 코드 안정성 확보  
  3. **프로모션**(N+1)과 **멤버십 할인(30%, 최대 8,000원)** 로직 구현  
  4. **재고 관리**(프로모션 재고 & 일반 재고) 및 **영수증 출력**  

---

<br/>

## 📂 프로젝트 폴더 구조 및 파일 설명

```plaintext
📦src
 ┣ 📂Constant
 ┃ ┣ 📜errorMessages.js
 ┃ ┣ 📜messages.js
 ┃ ┗ 📜productList.js
 ┣ 📂Controller
 ┃ ┗ 📜mainController.js
 ┣ 📂Model
 ┃ ┣ 📜calculatorForPromotionTime.js
 ┃ ┣ 📜calculatorForReceiptPrinting.js
 ┃ ┣ 📜giftOrDiscountStatusChecking.js
 ┃ ┗ 📜productsInPossessionData.js
 ┣ 📂Utils
 ┃ ┗ 📜parseProductsDetails.js
 ┣ 📂Validation
 ┃ ┣ 📜confirmationResponseValidator.js
 ┃ ┗ 📜purchaseQuantitiesValidator.js
 ┣ 📂View
 ┃ ┣ 📜inputViews.js
 ┃ ┗ 📜outputViews.js
 ┣ 📜App.js
 ┗ 📜index.js
```
<br/>

### 📂 Constant 폴더
- errorMessages.js: 사용자에게 잘못된 입력시 보여줄 오류 메시지를 정의합니다.
- messages.js: 사용자와의 상호작용에 필요한 일반적인 메시지나 안내 문구를 포함합니다. 
- productList.js: 상품 목록과 각 상품의 세부 정보를 정의하며, 상품 이름, 가격, 적용 가능한 프로모션 등을 포함합니다.

### 📂 Controller 폴더
- mainController.js: 애플리케이션의 메인 컨트롤 역할을 하며, 프로그램의 흐름을 관리합니다. 

### 📂 Model 폴더
- calculatorForPromotionTime.js: 특정 상품에 대한 프로모션이 현재 유효한지 판단하는 계산을 수행합니다.
- calculatorForReceiptPrinting.js: 최종 영수증 세부 사항을 계산하고, 각 항목, 할인, 총 결제 금액 등을 형식에 맞게 정리합니다.
- giftOrDiscountStatusChecking.js: 상품에 대한 프로모션 및 할인을 확인하여, 사용자가 선택한 옵션에 따라 증정 상품이나 할인을 적용할 수 있는지 판별합니다.
- productsInPossessionData.js: 사용자가 현재 소유한 상품의 데이터를 관리하며, 구매 시 재고 수량을 업데이트합니다.

### 📂 Utils 폴더
- parseProductsDetails.js: 사용자가 입력한 상품의 이름과 수량을 추출하여, 후속 처리에 필요한 데이터를 준비하는 기능을 수행합니다.

### 📂 Validation 폴더
- confirmationResponseValidator.js: 프로모션 혜택을 받을 것인지에 대한 사용자의 응답(Y/N)을 검증하여, 올바른 입력인지 확인합니다.
- purchaseQuantitiesValidator.js: 사용자가 입력한 구매 수량이 재고와 일치하는지, 그리고 프로모션 요건을 충족하는지 확인하여 유효성을 검사합니다.

### 📂 View 폴더
- inputViews.js: 사용자 입력을 관리합니다.
- outputViews.js: 사용자가 볼 수 있는 화면 출력을 관리합니다.

루트 파일

- App.js: 애플리케이션의 진입점으로, 프로그램을 초기화하고 mainController를 호출하여 주요 프로세스를 시작합니다.
- index.js: 모든 컴포넌트를 연결하는 메인 스크립트로, App.js를 호출하여 프로그램을 시작하게 합니다.

<br/>

## 🔧 주요 기능

- **상품 목록 및 재고 관리**
    - 상품과 재고를 관리하고, 사용자가 구매하려는 상품과 수량을 받아 처리합니다.
    - 상품 목록은 파일(`products.md`, `promotions.md`)을 통해 불러오며, 재고가 부족한 경우에는 `[ERROR]` 메시지를 출력합니다.
    
- **결제 시스템**
    - 각 상품의 가격과 수량을 바탕으로 총구매액을 계산하고, 프로모션 및 멤버십 할인 등을 반영하여 최종 결제 금액을 산출합니다.
    - 멤버십 할인은 30%가 적용되며, 할인 금액의 최대 한도는 8,000원입니다.

- **프로모션 처리**
    - 프로모션은 "N개 구매 시 1개 무료 증정" (1+1, 2+1) 형태로 진행되며, 적용 가능한 상품과 수량을 확인하여 고객에게 혜택을 제공합니다.
    - 프로모션 재고가 부족할 경우, 일반 재고에서 차감됩니다.

- **영수증 출력**
    - 구매 내역, 증정된 상품 내역, 금액 정보를 잘 정리된 형식으로 출력합니다.
    - 상품명, 수량, 가격을 구체적으로 표시하며, 행사 할인, 멤버십 할인, 최종 결제 금액을 계산하여 영수증을 출력합니다.

- **예외 처리**
    - 잘못된 입력에 대해 오류 메시지를 출력하고, 사용자가 올바른 값을 다시 입력할 수 있도록 처리합니다.
    - 예를 들어, 상품명이 틀리거나, 재고가 부족한 경우, 잘못된 형식으로 입력한 경우 등에는 `[ERROR]` 메시지를 출력합니다.

<br/>

## 📝 과제 진행 요구 사항
- 미션은 편의점 저장소를 생성하는 것으로 시작한다.
- 기능을 구현하기 전 README.md에 구현할 기능 목록을 정리해 추가한다.
- Git의 커밋 단위는 앞 단계에서 README.md에 정리한 기능 목록 단위로 추가한다.
- AngularJS Git Commit Message Conventions을 참고해 커밋 메시지를 작성한다.
- 자세한 과제 진행 방법은 프리코스 진행 가이드 문서를 참고한다.

<br/>

## ✅ 기능 요구 사항 체크리스트

### 📥 입력

- [X]  사용자에게 구매할 상품과 수량을 입력 받는다.
    - [X] 메세지: `‘구매하실 상품명과 수량을 입력해 주세요. (예: [사이다-2],[감자칩-1])’`
    - [X] 상품명, 수량은 하이픈(-)으로 구분한다.
    - [X] 개별 상품은 대괄호([])로 묶어 쉼표(,)로 구분한다.

- [X]  프로모션 적용이 가능한 상품에 대해 고객이 해당 수량보다 적게 가져온 경우 그 수량만큼 추가 여부를 입력받는다.
    - [X] 메시지: `‘현재 {상품명}은(는) 1개를 무료로 더 받을 수 있습니다. 추가하시겠습니까? (Y/N)'`
        - [X] Y를 입력한 경우: 증정 받을 수 있는 상품을 추가한다.
        - [X] N을 입력한 경우: 증정 받을 수 있는 상품을 추가하지 않는다. 

- [X]  프로모션 재고가 부족하여 일부 수량을 프로모션 혜택 없이 결제해야 하는 경우, 일부 수량에 대해 정가로 결제할지 여부를 입력받는다.
    - [X] 메시지: `‘현재 {상품명} {수량}개는 프로모션 할인이 적용되지 않습니다. 그래도 구매하시겠습니까? (Y/N)'`
        - [X] Y: 일부 수량에 대해 정가로 결제한다.
        - [X] N: 정가로 결제해야하는 수량만큼 제외한 후 결제를 진행한다.

- [X]  사용자에게 멤버십 할인 적용 여부를 입력 받는다.
    - [X] 메시지: `‘멤버십 할인을 받으시겠습니까? (Y/N)`’
        - [X] Y: 멤버십 할인을 적용한다.
        - [X] N: 멤버십 할인을 적용하지 않는다.
        
- [X]  추가 구매 여부를 입력 받는다.
    - [X] 메시지: `‘감사합니다. 구매하고 싶은 다른 상품이 있나요? (Y/N)’`
        - [X] Y: 재고가 업데이트된 상품 목록을 확인 후 추가로 구매를 진행한다.
        - [X] N: 구매를 종료한다.

### 📤 출력

- [X]  환영 인사, 상품명, 가격, 프로모션 이름, 재고를 출력한다.
    - [X]  구매 상품 내역, 증정 상품 내역, 금액 정보를 출력한다.
    // TODO: 이후 내부 기능 구현할 때, 구현
    - [X] 만약 재고가 0개라면 `’재고 없음'`을 출력한다.
    - [X] 환영인사: `‘안녕하세요. W편의점입니다.\n현재 보유하고 있는 상품입니다.’`
    - [X] 금액 숫자에는 천 단위로 콤마(,)를 붙인다
    - 보유 상품: {콜라} {1,000}원 {7}개 {탄산2+1}
        - 안녕하세요. W편의점입니다.
        현재 보유하고 있는 상품입니다.
        
        - 콜라 1,000원 10개 탄산2+1
        - 콜라 1,000원 10개
        - 사이다 1,000원 8개 탄산2+1
        - 사이다 1,000원 7개
        - 오렌지주스 1,800원 9개 MD추천상품
        - 오렌지주스 1,800원 재고 없음
        - 탄산수 1,200원 5개 탄산2+1
        - 탄산수 1,200원 재고 없음
        - 물 500원 10개
        - 비타민워터 1,500원 6개
        - 감자칩 1,500원 5개 반짝할인
        - 감자칩 1,500원 5개
        - 초코바 1,200원 5개 MD추천상품
        - 초코바 1,200원 5개
        - 에너지바 2,000원 5개
        - 정식도시락 6,400원 8개
        - 컵라면 1,700원 1개 MD추천상품
        - 컵라면 1,700원 10개

- [X]  영수증을 출력한다.
    - [X] 사용자가 구매한 상품명이 나온다.
    - [X] 사용자가 구매한 상품에 대한 수량이 나온다.
    - [X] 사용자가 구매한 상품명과 수량에 맞는 금액이 나온다.
    - [X] 사용자가 구매한 상품 중 프로모션 상품이 있다면 프로모션 상품의 상품명이 나온다.
    - [X] 사용자가 구매한 상품 중 프로모션 상품이 있다면 프로모션 상품의 수량이 나온다.

    - [X] 사용자가 구매한 모든 상품의 총 수량과 총 금액을 더한 값이 나온다.
    - [X] 사용자가 구매한 프로모션 상품의 수량에 따른 가격이 행사할인 가격으로 나온다.
    - [X] 사용자가 받는 맴버십 할인 금액 나온다. 
    - [X] 총구매액에서 '행사할인', '맴버십할인'의 금액을 차감한 '내실돈'금액이 나온다.

    - 고객의 구매 내역과 할인을 요약하여 출력한다.
    - 영수증 항목은 아래와 같다.
        - 구매 상품 내역: 구매한 상품명, 수량, 가격
        - 증정 상품 내역: 프로모션에 따라 무료로 제공된 증정 상품의 목록
        - 금액 정보
            - 총구매액: 구매한 상품의 총 수량과 총 금액
            - 행사할인: 프로모션에 의해 할인된 금액
            - 멤버십할인: 멤버십에 의해 추가로 할인된 금액
            - 내실돈: 최종 결제 금액
    - [X] 영수증의 구성 요소를 보기 좋게 정렬하여 고객이 쉽게 금액과 수량을 확인할 수 있게 한다.
        - [X] 정렬은 우테코 요구사항 간격 참고한다

```
===========W 편의점=============
상품명		수량	금액
콜라		3 	3,000
에너지바 		5 	10,000
===========증	정=============
콜라		1
==============================
총구매액		8	13,000
행사할인			-1,000
멤버십할인			-3,000
내실돈			 9,000
```

- [X]  영수증 출력 후 추가 구매를 진행할지 또는 종료할지를 선택할 수 있다.
- [X] 사용자가 잘못된 값을 입력할 경우 "[ERROR]"로 시작하는 메시지와 함께 `Error`를 발생시키고 해당 메시지를 출력한 다음 해당 지점부터 다시 입력을 받는다.

### 🔧 내부 기능

- [X]  구현에 필요한 상품 목록과 행사 목록을 파일 입출력을 통해 불러온다.
 - [X] `public/products.md`과 `public/promotions.md` 파일을 이용한다.
    - 두 파일 모두 내용의 형식을 유지한다면 값은 수정할 수 있다.

- [X] 최신 재고 상태를 유지한다.
    - [X] 각 상품의 재고 수량을 고려하여 결제 가능 여부를 확인한다.
    - [X] 고객이 상품을 구매할 때마다, 결제된 수량만큼 해당 상품의 재고에서 차감하여 수량을 관리한다.
    - [X] 재고를 차감함으로써 시스템은 최신 재고 상태를 유지하며, 다음 고객이 구매할 때 정확한 재고 정보를 제공한다.

- [X] 프로모션 할인을 적용한다.
    - [X] 사용자가 구매할 상품이 하나라고 가정하고, 그 상품명과 개수를 return하는 함수를 만든다.   
    - [X] 사용자가 들고온 상품이 프로모션 상품으로 추가 증정이 가능할 때, 추가 입력을 받는 메시지 출력하여 입력을 받는다. 
    - [X] 프로모션 상품, 일반 상품들을 따로 분류를 한다.
    - [X] 프로모션 적용이 가능한 상품에 대해 고객이 해당 수량보다 적게 가져온 경우, 필요한 수량을 추가로 가져오면 혜택을 받을 수 있음을 안내한다.
    - [X] 프로모션 재고가 부족하여 일부 수량을 프로모션 혜택 없이 결제해야 하는 경우, 일부 수량에 대해 정가로 결제하게 됨을 안내한다.
    - [X] 프로모션은 N개 구매 시 1개 무료 증정(Buy N Get 1 Free)의 형태로 진행된다.
    - [X] 오늘 날짜가 프로모션 기간 내에 포함된 경우에만 할인을 적용한다.
    - [X] 프로모션 기간 중이라면 프로모션 재고를 우선적으로 차감한다. 
    - [X] 프로모션 재고가 부족할 경우에는 일반 재고를 사용한다.
    - [X] 1+1 또는 2+1 프로모션이 각각 지정된 상품에 적용되며, 동일 상품에 여러 프로모션이 적용되지 않는다.
    - [X] 프로모션 혜택은 프로모션 재고 내에서만 적용할 수 있다.


- [X] 멤버십 할인을 적용한다.
    - [X] 프로모션 적용 금액의 합을 구한다. 
    - [X] 총 금액에서 프로모션 미적용 금액의 차이를 구한다.

    - [X] 프로모션 미적용 금액에서 30%인 값을 구한다. 
    - [X] 맴버십 할인의 최대 한도는 8,000으로 설정한다. 

- [X]  최종 결제 금액 계산을 한다.
    - [X] 사용자가 입력한 상품의 가격과 수량을 기반으로 최종 결제 금액을 계산한다.
    - [X] 총구매액은 상품별 가격과 수량을 곱하여 계산한다.
    - [X] 프로모션 및 멤버십 할인 정책을 반영하여 최종 결제 금액을 산출한다.

### ⚠️ 예외 처리

- [ ] 사용자가 잘못된 값을 입력했을 때, "[ERROR]"로 시작하는 오류 메시지와 함께 상황에 맞는 안내를 출력한다.
    - [X] 구매 수량이 재고 수량을 초과한 경우: `[ERROR] 재고 수량을 초과하여 구매할 수 없습니다. 다시 입력해 주세요.`
    - [X] 구매할 상품과 수량 형식이 올바르지 않은 경우: `[ERROR] 올바르지 않은 형식으로 입력했습니다. 다시 입력해 주세요.`
    - [X] 존재하지 않는 상품을 입력한 경우: `[ERROR] 존재하지 않는 상품입니다. 다시 입력해 주세요.`
    - [ ] 기타 잘못된 입력의 경우: `[ERROR] 잘못된 입력입니다. 다시 입력해 주세요.`

- [X] 프로모션 추가 증정 
- [X] 프로모션 미적용 알림
- [X] 멤버십 할인 추가 증정
    - [X] 빈 값을 입력한 경우: `[ERROR] 빈 값을 입력하셨습니다. 다시 입력해 주세요.`
    - [X] Y, N 이외 다른 문자를 입력한 경우: `[ERROR] 'Y', 'N' 이외에 다른 것을 입력하셨습니다. 다시 입력해 주세요.`

###  📝 테스트
- [X] 구매 상품 이름
    - [X] 존재하지 않는 상품을 입력한 경우 오류가 발생해야 한다.
    - [X] 존재하는 상품을 입력한 경우 오류가 발생하지 않아야 한다.
- [X] 구매 상품 개수
    - [X] 재고 수량을 초과하여 구매하려고 할 때 오류가 발생해야 한다.
    - [X] 재고 수량 이하로 구매할 경우 오류가 발생하지 않아야 한다.

<br/>

## ✅ 프로그래밍 요구 사항 체크리스트

### 1.
- [X] Node.js 20.17.0 버전에서 실행 가능해야 한다.
- [X] 프로그램 실행의 시작점은 App.js의 run()이다.
- [X] package.json 파일은 변경할 수 없으며, 제공된 라이브러리와 스타일 라이브러리 이외의 외부 라이브러리는 사용하지 않는다.
- [X] 프로그램 종료 시 process.exit()를 호출하지 않는다.
- [X] 프로그래밍 요구 사항에서 달리 명시하지 않는 한 파일, 패키지 등의 이름을 바꾸거나 이동하지 않는다.
- [X] 자바스크립트 코드 컨벤션을 지키면서 프로그래밍한다.
  - 기본적으로 JavaScript Style Guide를 원칙으로 한다.

### 2.
- [X] indent(인덴트, 들여쓰기) depth를 3이 넘지 않도록 구현한다. 2까지만 허용한다.
  - 예를 들어 while문 안에 if문이 있으면 들여쓰기는 2이다.
  - 힌트: indent(인덴트, 들여쓰기) depth를 줄이는 좋은 방법은 함수(또는 메서드)를 분리하면 된다.
- [X] 3항 연산자를 쓰지 않는다.
- [ ] 함수(또는 메서드)가 한 가지 일만 하도록 최대한 작게 만들어라.
- [X] Jest를 이용하여 정리한 기능 목록이 정상적으로 작동하는지 테스트 코드로 확인한다.
  - 테스트 도구 사용법이 익숙하지 않다면 아래 문서를 참고하여 학습한 후 테스트를 구현한다.
   - Using Matchers
   - Testing Asynchronous Code
   - Jest로 파라미터화 테스트하기: test.each(), describe.each()

### 3. 
- [X] else를 지양한다.
  - 때로는 if/else, switch문을 사용하는 것이 더 깔끔해 보일 수 있다. 어느 경우에 쓰는 것이 적절할지 스스로 고민해 본다.
  - 힌트: if 조건절에서 값을 return하는 방식으로 구현하면 else를 사용하지 않아도 된다.
- [X] 구현한 기능에 대한 단위 테스트를 작성한다. 단, UI 로직은 제외한다.

### 4. 
- [ ] 함수(또는 메서드)의 길이가 10라인을 넘어가지 않도록 구현한다.
  - 함수(또는 메서드)가 한 가지 일만 잘 하도록 구현한다.
- [X] 입출력을 담당하는 클래스를 별도로 구현한다.
  - 아래 InputView, OutputView 클래스를 참고하여 입출력 클래스를 구현한다.
  - 클래스 이름, 메소드 반환 유형, 시그니처 등은 자유롭게 수정할 수 있다.

```jsx
  const InputView = {
      async readItem() {
          const input = await MissionUtils.Console.readLineAsync("구매하실 상품명과 수량을 입력해 주세요. (예: [사이다-2],[감자칩-1])");
          // ...
      }
      // ...
  }

```

```jsx
  const OutputView = {
      printProducts() {
          MissionUtils.Console.print("- 콜라 1,000원 10개 탄산2+1");
          // ...
      }
      // ...
  }
```

<br/>

## 라이브러리
- [X] @woowacourse/mission-utils에서 제공하는 Console 및 DateTimes API를 사용하여 구현해야 한다.
  - 현재 날짜와 시간을 가져오려면 DateTimes의 now()를 활용한다.
  - 사용자의 값을 입력 및 출력하려면 Console.readLineAsync()와 Console.print()를 활용한다.

<br/>

## ✅ **과제 제출 전 체크 리스트**

<br/>

- [X] 기능을 올바르게 구현했더라도 **요구 사항에 명시된 출력 형식을 따르지 않으면 0점**을 받게 된다.
- [X] 기능 구현을 완료한 후 아래 가이드에 따라 모든 테스트가 성공적으로 실행되는지 확인한다.
- [X] **테스트가 실패하면 점수가 0점**이 되므로 제출하기 전에 반드시 확인한다.

### **테스트 실행 가이드**

- [X] 터미널에서 `node --version`을 실행하여 Node.js 버전이 20.17.0 이상인지 확인한다.
- [X] 아래 명령을 입력하여 패키지를 설치한 후 실행하는 데 문제가 없어야 한다.
```
npm install
npm run test
npm run start
```
